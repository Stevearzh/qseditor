<qseditor name="qseditor">
	<script src="./md2bbc/src/showdown.min.js"></script>
	<script src="./md2bbc/mkd.js"></script>
	<script src="./bbcode/bbcode.js"></script>

	<textarea id="qse-text"></textarea>
	<iframe sandbox id="qse-preview"></iframe>
	<button id="qse-switch-button">switch</button>
	<button id="qse-preview-button">preview</button>

	<script>
		qse = {
			'parse': (new Showdown.converter(conv_opts)).makeBBCode,
			'preview': function(textares, preview){
				text = (window.localStorage.getItem('qsemode') == "markdown")?this.parse(textares.value):textares.value;
				preview.srcdoc = bbcode.render(text);
//				preview.srcdoc = XBBCODE.process({
//					'text': text,
//					'removeMisalignedTags': false,
//					'addInLineBreaks': false
//				}).html;
			},
			'init': function(){
				textares = document.getElementById('qse-text');
				preview = document.getElementById('qse-preview');
				switchb = document.getElementById('qse-switch-button');
				previewb = document.getElementById('qse-preview-button');

				switchb.onclick = function(){
					if(window.localStorage.getItem('qsemode') == "bbcode"){
						window.localStorage.setItem('qsemode', "markdown");
					}else if(window.localStorage.getItem('qsemode') == "markdown"){
						window.localStorage.setItem('qsemode', "bbcode");
					};
				};

				previewb.onclick = function(){
					qse.preview(textares, preview);
				};
			}
		};
		qse.init();
	</script>
</qseditor>
